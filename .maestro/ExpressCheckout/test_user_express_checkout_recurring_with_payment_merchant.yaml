appId: com.airwallex.paymentacceptance
tags:
  - card
  - user
  - express-checkout
platform:
  android:
    disableAnimations: true  # Disables system animations on the Android emulator
env:
  IS_GUEST: false
---
- runFlow:
    when:
      true: ${IS_RECORDING}
    commands:
      - startRecording: test_user_express_checkout_recurring_merchant
- launchApp
- runScript: ../Card/cards.js
- runScript: ../Common/settings.js
- tapOn: "Integrate with Airwallex UI"
# cleanup existing consents for current user
- runFlow:
    file: flow_cleanup_consents.yaml
# start one-off express checkout - save card
- runFlow:
    file: flow_card_express_checkout.yaml
    env:
      CHECKOUT_MODE: ${output.settings.checkoutMode.recurringAndPayment}
      CARD_NUMBER: ${output.cards.visa3DS}
      HANDLE_3DS: true
      NEXT_TRIGGERED_BY: ${output.settings.nextTriggeredBy.merchant}
# cleanup existing consents
- runFlow:
    file: flow_cleanup_consents.yaml
    env:
      ASSERT_NOT_EXISTING: true
      NEXT_TRIGGERED_BY: ${output.settings.nextTriggeredBy.customer}
- runFlow:
    when:
      true: ${IS_RECORDING}
    commands:
      - stopRecording